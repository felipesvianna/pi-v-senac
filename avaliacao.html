<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/stylepages.css" />
    <title>Certificação AQUA-HQE</title>
  </head>
  <body class="container">
    <header class="header">
      <div class="logo">
        <a href="index.html" style="text-decoration: none">
          <h1 class="logo-font">LOGO</h1>
        </a>
      </div>
      <p class="header-text">Empreendimentos</p>
      <div class="sair">
        <a class="sair-font link-button-header" href="index.html">Sair</a>
      </div>
    </header>

    <form id="form-avaliacao">
    <section class="section-form">
      <div class="text-form">
        <p>Categoria 1: Edifício e seu entorno</p>
      </div>
      <div class="forms">
        <div class="subcategorie">
          <p>Análise do local do empreendimento</p>
        </div>
        <div class="subcategorie1">
          <div class="item">
            <p class="text-item">
              Realizar uma análise das vantagens e limitações do local do
              empreendimento antes do estudo de projeto. Esta análise é o
              pré-requisito necessário à concepção de um empreendimento AQUA.
              Ela identifica os elementos a serem levados em conta na integração
              dos edifícios ao local. O nível de exigências para as outras
              categorias depende desta análise e dos objetivos do empreendedor
              (ver informações complementares).<br />Um relatório sobre a
              análise do local do empreendimento deve ser entregue a todos os
              intervenientes. Ele deve conter recomendações necessárias para a
              construção do programa, por tema analisado e/ou sob a forma de
              balanço global, a serem implementadas no empreendimento.
            </p>

            <div class="checkbox-section">
              <label class="checkbox-label" for="cat1-criterio-1"
                >Critério atendido</label
              >
              <input class="box" type="checkbox" id="cat1-criterio-1" name="" value="1" />
            </div>
          </div>
          <div class="item">
            <p class="text-item">
              Realizar um estudo específico com o objetivo de identificar a
              situação inicial de insolação e luminosidade para a vizinhança.<br />
              E<br />
              Tomar medidas(1) para otimizar esta situação, especialmente sobre
              a duração da insolação e minimizar os efeitos de sombreamento
              causado pela implantação do empreendimento sobre os edifícios
              vizinhos.
            </p>

            <div class="checkbox-section">
              <label class="checkbox-label" for="cat1-criterio-2"
                >Critério atendido</label
              >
              <input class="box" type="checkbox" id="cat1-criterio-2" name="" value="2" />
            </div>
          </div>
          <div class="item">
            <p class="text-item">
              Melhorar as vistas acessíveis à vizinhança, melhor distribuindo as
              superfícies de espaços de paisagismo e a visibilidade em relação
              ao existente, solucionando e vegetalizando as construções e
              diminuindo, eventualmente, as sombras (2) .
            </p>
            
            <div class="checkbox-section">
              <label class="checkbox-label" for="cat1-criterio-3"
                >Critério atendido</label
              >
              <input class="box" type="checkbox" id="cat1-criterio-3" name="" value="3" />
            </div>
          </div>
          <div class="item">
            <p class="text-item">
              Explicitar, em cada categoria, como a análise do local foi
              aproveitada e como permitiu hierarquizar as categorias. O
              conhecimento do local deve permitir tirar vantagem do contexto, e
              ao mesmo tempo reduzir suas limitações.
            </p>

            <div class="checkbox-section">
              <label class="checkbox-label" for="cat1-criterio-4"
                >Critério atendido</label
              >
              <input class="box" type="checkbox" id="cat1-criterio-4" name="" value="4" />
            </div>
          </div>
        </div>
      </div>
      <div class="forms">
        <div class="subcategorie">
          <p>Organização do terreno de modo a criar um ambiente agradável</p>
        </div>
        <div class="subcategorie1">
          <div class="item">
            <p class="text-item">
              Incluir no plano de massa elementos que permitam criar um ambiente
              agradável:
              <br />
              - pátios, <br />
              - playgrounds, áreas de lazer, <br />
              - áreas de armazenamento de resíduos, <br />
              - organização/escolha da vegetação, (escolha de plantas de
              espécies complementares, não-invasivas, bem-adaptadas ao clima e
              ao terreno, com necessidades limitadas de irrigação e manutenção,
              visando minimizar os impactos sanitários no terreno, com a
              limitação das espécies alergênicas e tóxicas, etc.), <br />
              - criação de um espaço dedicado à melhoria da qualidade geral de
              vida, etc.
            </p>

            <div class="checkbox-section">
              <label class="checkbox-label" for="cat1-criterio-5"
                >Critério atendido</label
              >
              <input class="box" type="checkbox" id="cat1-criterio-5" name="" value="5" />
            </div>
          </div>
        </div>
      </div>
      <div class="forms">
        <div class="subcategorie">
          <p>Organização do terreno de modo a favorecer a ecomobilidade</p>
        </div>
        <div class="subcategorie1">
          <div class="item">
            <p class="text-item">
              Realizar uma análise das vantagens e limitações do local do
              empreendimento antes do estudo de projeto. Realizar um inventário
              dos modos de transporte existentes nas proximidades do
              empreendimento (bicicletas, pedestres, transporte público, etc.).
            </p>

            <div class="checkbox-section">
              <label class="checkbox-label" for="cat1-criterio-6"
                >Critério atendido</label
              >
              <input class="box" type="checkbox" id="cat1-criterio-6" name="" value="6" />
            </div>
          </div>
          <div class="item">
            <p class="text-item">
              Incluir, no plano de massa, elementos do projeto que permitam
              reduzir os impactos e/ou incômodos relacionados ao transporte:
              <br />
              - separação efetiva entre as vias para pedestres e os acessos para
              veículos, <br />
              - estacionamentos para ambulâncias, para veículos, para
              bicicletas, para pessoas portadoras de deficiências, etc. <br />
              - disponibilidade de um ou vários pontos de recarga para veículos
              elétricos, <br />
              - ciclovias, etc.
            </p>

            <div class="checkbox-section">
              <label class="checkbox-label" for="cat1-criterio-7"
                >Critério atendido</label
              >
              <input class="box" type="checkbox" id="cat1-criterio-7" name="" value="7" />
            </div>
          </div>
        </div>
      </div>
      </section>
      <button type="button" id="submit-btn" class="submit-button">Salvar alterações</button>
    </form>
    </section>

    <section class="avaliacao-section">
      <div class="avaliacao-titulo footer-font">
        Avaliação da categoria 1
      </div>
      <div>
        <table class="tabela-avaliacao">
          <tr>
            <td>Nível B</td>
            <td>Respeito ao nível BASE</td>
            <td id="nivelB">Não atingido</td>
          </tr>
          <tr>
            <td>Nível BP</td>
            <td>Respeito ao nível BASE E Soma dos pontos >= 1</td>
            <td id="nivelBP">Não atingido</td>
          </tr>
          <tr>
            <td>Nível MP</td>
            <td>Respeito ao nível BASE E Soma dos pontos >= 3</td>
            <td id="nivelMP">Não atingido</td>
          </tr>
        </table> 
      </div>
    </section>
    <footer class="footer">
      <p class="footer-font">Projeto Integrador - Grupo 34</p>
    </footer>
  </body>
</html>

<script type="module">
  import avaliacao from "./js/avaliacaoController.js";

  function getCheckboxValues() {
    let checkboxValues = [];

    const checkboxes = document.querySelectorAll('input[type="checkbox"]');

    checkboxes.forEach(function (checkbox) {
        if (checkbox.checked) {
            checkboxValues.push(parseInt(checkbox.value));
        }
    });

    return checkboxValues;
  }

  function setCheckboxValues(criteriosIds) {
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');

    criteriosIds.forEach(checkboxId => {
      const checkbox = document.getElementById('cat1-criterio-' + checkboxId);

      if (checkbox) {
        checkbox.checked = true;
      }
    });
  }

  function avaliar(idEmpreendimento, idCategoria) {
    const nivelB = document.getElementById("nivelB");
    const nivelBP = document.getElementById("nivelBP");
    const nivelMP = document.getElementById("nivelMP");
    
    const resultado = avaliacao.calcularAvaliacao(idEmpreendimento, idCategoria);

    nivelB.innerHTML = resultado.nivelB;
    nivelBP.innerHTML = resultado.nivelBP;
    nivelMP.innerHTML = resultado.nivelMP;
  }

  const searchParams = new URLSearchParams(window.location.search);
  const idEmpreendimento = parseInt(searchParams.get('idEmpreendimento'));
  const idCategoria = parseInt(searchParams.get('idCategoria'));
  const formAvaliacao = document.getElementById("form-avaliacao");
  const submitBtn = document.getElementById("submit-btn");

  const marcados = avaliacao.carregarAvaliacao(idEmpreendimento, idCategoria);
  const checkboxesIds = marcados.map(({criterio_id}) => criterio_id);

  setCheckboxValues(checkboxesIds);
  avaliar(idEmpreendimento, idCategoria);

  submitBtn.addEventListener("click", () => {
    const criterios = getCheckboxValues();
    avaliacao.registrarAvaliacao(idEmpreendimento, idCategoria, criterios);
    avaliar(idEmpreendimento, idCategoria);
  });
</script>